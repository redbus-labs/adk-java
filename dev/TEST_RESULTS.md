# SSE Endpoint Test Results

**Date**: January 24, 2026  
**Author**: Sandeep Belgavi  
**Server**: AdkWebServer (Spring Boot + HttpServer SSE)

## Server Startup Logs

```
2026-01-23T23:52:55.101+05:30  INFO --- Tomcat initialized with port 8080 (http)
2026-01-23T23:52:55.279+05:30  INFO --- Starting HttpServer SSE service on 0.0.0.0:9085
2026-01-23T23:52:55.295+05:30  INFO --- HttpServer SSE service started successfully (default). Endpoint: http://0.0.0.0:9085/run_sse
2026-01-23T23:52:55.571+05:30  INFO --- Tomcat started on port 8080 (http) with context path '/'
2026-01-23T23:52:55.574+05:30  INFO --- Started AdkWebServer in 1.001 seconds
```

**Status**: ‚úÖ Both servers started successfully
- Spring Boot server: Port 8080
- HttpServer SSE: Port 9085

## Test 1: HttpServer SSE Endpoint (Port 9085)

### Request
```bash
curl -N -X POST http://localhost:9085/run_sse \
  -H "Content-Type: application/json" \
  -d '{
    "appName": "GoogleAudioVideoStreamWithTrig",
    "userId": "test-user",
    "sessionId": "test-session-http-123",
    "newMessage": {
      "role": "user",
      "parts": [{"text": "Hello, testing HttpServer SSE endpoint"}]
    },
    "streaming": true
  }'
```

### Expected Behavior
- Endpoint should accept POST request
- Parse JSON request body
- Start SSE stream
- Send events as they are generated

### Issues Found
1. **Initial Issue**: Gson cannot deserialize abstract `Content` class
   - **Fix**: Changed from Gson to Jackson ObjectMapper
   - **Status**: ‚úÖ Fixed

2. **Agent Not Found**: If using non-existent appName
   - **Expected**: Returns 500 error with message
   - **Status**: ‚úÖ Working as expected

## Test 2: Spring SSE Endpoint (Port 8080)

### Request
```bash
curl -N -X POST http://localhost:8080/run_sse_spring \
  -H "Content-Type: application/json" \
  -d '{
    "appName": "GoogleAudioVideoStreamWithTrig",
    "userId": "test-user",
    "sessionId": "test-session-spring-456",
    "newMessage": {
      "role": "user",
      "parts": [{"text": "Hello, testing Spring SSE endpoint"}]
    },
    "streaming": true
  }'
```

### Expected Behavior
- Endpoint should accept POST request
- Use Spring's SseEmitter for streaming
- Send events as they are generated

### Status
- ‚úÖ Endpoint exists and responds
- ‚úÖ Request parsing works (Jackson handles abstract classes)
- ‚úÖ SSE stream starts correctly

## Test 3: CORS Preflight (OPTIONS)

### Request
```bash
curl -X OPTIONS http://localhost:9085/run_sse \
  -H "Origin: http://localhost:3000" \
  -H "Access-Control-Request-Method: POST" \
  -H "Access-Control-Request-Headers: Content-Type" \
  -v
```

### Response Headers
```
HTTP/1.1 200 OK
Access-control-allow-headers: Content-Type
Access-control-max-age: 3600
Access-control-allow-methods: POST, OPTIONS
Access-control-allow-origin: *
```

**Status**: ‚úÖ CORS preflight working correctly

## Test 4: Error Handling

### Missing appName
```bash
curl -X POST http://localhost:9085/run_sse \
  -H "Content-Type: application/json" \
  -d '{"userId":"test","sessionId":"test","newMessage":{"role":"user","parts":[{"text":"Hello"}]}}'
```

**Expected**: 400 Bad Request  
**Status**: ‚úÖ Working

### Missing sessionId
```bash
curl -X POST http://localhost:9085/run_sse \
  -H "Content-Type: application/json" \
  -d '{"appName":"test-app","userId":"test","newMessage":{"role":"user","parts":[{"text":"Hello"}]}}'
```

**Expected**: 400 Bad Request  
**Status**: ‚úÖ Working

## Summary

### ‚úÖ Working Correctly
1. HttpServer SSE endpoint on port 9085
2. Spring SSE endpoint on port 8080
3. CORS preflight handling
4. Error handling (missing fields)
5. JSON parsing with Jackson ObjectMapper
6. Server startup and initialization

### üîß Fixed Issues
1. Changed JSON parsing from Gson to Jackson ObjectMapper to handle abstract `Content` class
2. Updated default port to 9085 for HttpServer SSE
3. Made HttpServer SSE the default endpoint

### üìù Notes
- Both endpoints require a valid `appName` that exists in the agent registry
- Available agents: `GoogleAudioVideoStreamWithTrig`, `product_proxy_agent`
- SSE streams will send events as they are generated by the agent
- The `-N` flag in curl is essential for seeing streaming events

## Next Steps

1. ‚úÖ Server starts successfully
2. ‚úÖ Both SSE endpoints are accessible
3. ‚úÖ JSON parsing works correctly
4. ‚úÖ Error handling works
5. ‚è≠Ô∏è Test with actual agent execution (requires valid agent configuration)

## Files Modified for Testing

- `HttpServerSseController.java`: Changed from Gson to Jackson ObjectMapper
- `HttpServerSseConfig.java`: Updated default port to 9085
- `ExecutionController.java`: Updated endpoint to `/run_sse_spring`

## Commit Location

All test files and documentation should be committed to:
- `adk-java/dev/TEST_SSE_ENDPOINT.md` - Comprehensive testing guide
- `adk-java/dev/QUICK_START_SSE.md` - Quick start guide
- `adk-java/dev/test_sse.sh` - Automated test script
- `adk-java/dev/test_request.json` - Sample request file
- `adk-java/dev/COMMIT_GUIDE.md` - Commit guide
- `adk-java/dev/TEST_RESULTS.md` - This file

See `COMMIT_GUIDE.md` for detailed commit instructions.
